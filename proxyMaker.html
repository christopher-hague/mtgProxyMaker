<html>
  <head>
    <style>
      
      body {
        margin: 0px;
        padding: 0px;
      }

      @page{ 
        size: auto;   /* auto is the initial value */
        margin-left: 8mm;/* this affects the margin in the printer settings */
	margin-top: 0mm;
	margin-bottom: 0mm;
      }
      img{
	padding: 2px;
      }
    
    </style>
  </head>

  <body>
    <form id="card-input">
      <input id="card-search" type="search">
      <input type="submit" value="Get Proxy">
	  <label>Card count<span id="card-count"> </span></label>
    </form>

    <script>
      
      function makeRange(start,stop,increment){
        var result = [];
	    var increment = increment || 1;
	    for(var i = start; i < stop; i+=increment){
	      result.push(i);
        }
	    return result;
       }


	  function generateEDHREC(cards,cb){
	    for (var i = 0; i < cards.length; i++){
          console.log(cards[i].replace(/-/g, ' '));
          $('#card-search').value = cards[i].replace(/-/g, ' ');
          $('#card-input > input[type="submit"]:nth-child(2)').click();
		  updateCardCount();
         }
	   }

	   function removeDuplicates(cards,cb){
	     for (var i = 0; i < cards.length; i++){
		   let collection = document.querySelectorAll("."+cards[i]);

		   collection.forEach((ele,i) => {
		     if (i > 0){ ele.remove() }
		   })
		 }
		 updateCardCount();
	   
	   }

	   function removeEmpties(cards,cb){
         for (var i = 0; i < cards.length; i++){
           let collection = document.querySelectorAll("."+cards[i]);

           collection.forEach((ele,i) => {
             if (ele.src.split("=")[1].split("&")[0] === "0"){ ele.remove() }
           })
         }

		 updateCardCount();

       }

	   function updateCardCount(){
	     $('#card-count').textContent = document.querySelectorAll("img").length; 
	   }

      function appendCards(cardIds,name){
        cardIds.forEach(function(cardId){
	      var cardImage = document.createElement('img');
	      var cardImageSrc = 'http://gatherer.wizards.com/Handlers/Image.ashx?multiverseid=' + cardId.multiverse_id + '&type=card';
	      cardImage.src = cardImageSrc;
	  
	      cardImage.classList.add(cardId.name.replace(/\s+/g, '-'));
	    
	      cardImage.onclick = function(){
	        this.remove();
			updateCardCount();

	      }
	      document.body.appendChild(cardImage);
	    })
      }

      function parseAndAppendCards(cardDataArray){
        cardDataArray.forEach(function(current,index,collection){
	      var multiverseIds = [];
          var name = current.name;

	      current.editions.forEach(function(current,index,collection){
		    //console.log(current)
			current.name = name; //carry the name over from the outer loop
	        multiverseIds.push(current);
	      })


	    appendCards(multiverseIds,name);
	    });
      
      }

      //appendCards(makeRange(0,2));

      window.addEventListener("load",function(){
        function sendData() {
	    var XHR = new XMLHttpRequest();

	    XHR.addEventListener("load",function(event){
	      //if data is successfully sent
	      console.log(event.target.responseText);
	      var cardData = JSON.parse(event.target.responseText);
	      parseAndAppendCards(cardData);

	    });

	    XHR.addEventListener("error", function(event){
	      console.log('card request error')
	    });

	    var searchName = document.getElementById("card-search").value;

	    var apiRequestString = "https://api.deckbrew.com/mtg/cards?name=" + searchName;

	    XHR.open("GET", apiRequestString);

	    XHR.send();
	
	  };

	  var form = document.getElementById("card-input");

	  form.addEventListener("submit", function(event){
	    event.preventDefault();
	    sendData();

	  });
      
    });

    </script>
    
    <img src="http://gatherer.wizards.com/Handlers/Image.ashx?multiverseid=0&amp;type=card">
    <img src="http://gatherer.wizards.com/Handlers/Image.ashx?multiverseid=1&amp;type=card">
  </body>
</html>
